!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("AnimatorFactory",[],t):"object"==typeof exports?exports.AnimatorFactory=t():e.AnimatorFactory=t()}(window,function(){return function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();var r=function(){function e(t,o,i,n,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.json=t,this.fps=a||30,this.plot=i,this.turf=n,this.map=o,this.layer=r||"_ctfoSchemaPolygon_",this.easing=function(e){return e},this.duration=1}return n(e,[{key:"initAnalysis",value:function(e){e=e||this.json;var t=JSON.parse(e);this.duration=1e3*t.totalTime;var o=t.steps,i=this.fps,n=this.turf,r=[];return o.forEach(function(e,t){var o=e.stepTotalTime*i,a=e.elements,s=Array.apply(null,Array(o));a.forEach(function(e,t){e.runTime;for(var o=e.delay*i;o<(e.delay+e.runTime)*i;o++){var r={};if(s[o]||(s[o]=new Array),r.action="none",r.type=e.elementType,r.id=e.elementId,e.isChange&&(r.action="update"),o===e.delay*i&&(r.action="add",e.style&&(r.style=e.style)),o===e.runTime*i-1&&e.isRemove&&(r.action="delete"),"none"!==r.action){for(var a=void 0,l=void 0,f=void 0,u=void 0,c=void 0,y={units:"meters"},m=e.keyPoints1,p=e.keyPoints2,g=[],d=0;d<m.length;d++)a=n.point(m[d]),l=n.point(p[d]),f=n.distance(a,l,y),u=n.lineString([m[d],p[d]]),f<10?g[d]=a.geometry.coordinates:(c=f/(e.runTime*i),g[d]=n.along(u,c*(o-e.delay+1),y).geometry.coordinates);r.keyPoint=g,s[o].push(r)}else s[o].push(r)}}),s.forEach(function(e,t){r.push(e)})}),this.setAnimatArr(r),r}},{key:"setAnimatArr",value:function(e){this.animatArr=e}},{key:"getAnimatArr",value:function(){return this.animatArr}},{key:"start",value:function(e){var t=void 0,o=Date.now(),i=1e3/this.fps,n=0,r=Date.now();console.log("startTime...."+r);var a=this.duration,s=this,l=!0;requestAnimationFrame(function f(){var u=(Date.now()-r)/a;n<s.getAnimatArr().length?(t=Date.now(),t-o>i&&(n++,s.progress(n,s.easing(u),u),o=Date.now())):(e?l=!1:(l=!0,n=0,r=Date.now()),console.log("startTime_end...."+(Date.now()-r))),l&&requestAnimationFrame(f)})}},{key:"progress",value:function(e){var t=this.getAnimatArr()[e-1];t&&t.forEach(function(e){this._playElement(e)}.bind(this))}},{key:"addStepFeatures",value:function(e){e&&(e.elements&&e.elements.forEach(function(e){this._addStepFeature(e)}.bind(this)))}},{key:"_addStepFeature",value:function(e){if(e){var t=void 0,o=this.plot.plotDraw.createPlot(e.elementType);o.setPoints(e.keyPoints1);var i=o.getCoordinates();if((t=this._getGeometry(e.elementType,i))&&(t.setId(e.elementId),t.set("isPlot",!0),e.style)){var n=this.setStyle(e.style);n&&t.setStyle(n)}}}},{key:"_playElement",value:function(e){if(e&&"none"!==e.action)if("delete"!==e.action){var t=this.map.getFeatureById(e.id),o=this.plot.plotDraw.createPlot(e.type);o.setPoints(e.keyPoint);var i=o.getCoordinates();if("add"!==e.action)t&&t.getGeometry().setCoordinates(i);else if(t?t.getGeometry().setCoordinates(i):(t=this._getGeometry(e.type,i))&&t.setId(e.id),e.style){var n=this.setStyle(e.style);n&&t&&t.setStyle(n)}}else this.map.removeFeatureById(e.id)}},{key:"_getGeometry",value:function(e,t){var o=null;return e&&("Polyline"===e||"StraightArrow"===e||"Curve"===e||"FreeHandLine"===e||"Arc"===e?o=this.map.addPolyline(t.join(","),{layerName:this.layer,zoomToExtent:!1}):"Point"===e||"Pennant"===e?o=this.map.addPoint(t.join(","),{layerName:this.layer,zoomToExtent:!1}):"PlotText"===e||"TextArea"===e||"PlotTextBox"===e||(o=this.map.addPolygon(t.join(","),{layerName:this.layer,zoomToExtent:!1}))),o}},{key:"setStyle",value:function(e){var t=e&&"object"===(void 0===e?"undefined":i(e))?e:{},o=new ol.style.Style({});return t.fill&&"object"===i(t.fill)&&o.setFill(this._getFill(t.fill)),t.image&&"object"===i(t.image)&&o.setImage(this._getImage(t.image)),t.stroke&&"object"===i(t.stroke)&&o.setStroke(this._getStroke(t.stroke)),t.text&&"object"===i(t.text)&&o.setText(this._getText(t.text)),o}},{key:"_getFill",value:function(e){try{return e=e||{},new ol.style.Fill({color:e.fillColor?e.fillColor:void 0})}catch(e){console.log(e)}}},{key:"_getStroke",value:function(e){try{return e=e||{},new ol.style.Stroke({color:e.strokeColor?e.strokeColor:void 0,lineCap:e.strokeLineCap&&"string"==typeof e.strokeLineCap?e.strokeLineCap:"round",lineJoin:e.strokeLineJoin&&"string"==typeof e.strokeLineJoin?e.strokeLineJoin:"round",lineDash:e.strokeLineDash?e.strokeLineDash:void 0,lineDashOffset:"number"==typeof e.strokeLineDashOffset?e.strokeLineDashOffset:"0",miterLimit:"number"==typeof e.strokeMiterLimit?e.strokeMiterLimit:10,width:"number"==typeof e.strokeWidth?e.strokeWidth:void 0})}catch(e){console.log(e)}}},{key:"_getText",value:function(e){try{return new ol.style.Text({font:e.textFont&&"string"==typeof e.textFont?e.textFont:"10px sans-serif",offsetX:"number"==typeof e.textOffsetX?e.textOffsetX:0,offsetY:"number"==typeof e.textOffsetY?e.textOffsetY:0,scale:"number"==typeof e.textScale?e.textScale:void 0,rotation:"number"==typeof e.textRotation?e.textRotation:0,text:e.text&&"string"==typeof e.text?e.text:void 0,textAlign:e.textAlign&&"string"==typeof e.textAlign?e.textAlign:"start",textBaseline:e.textBaseline&&"string"==typeof e.textBaseline?e.textBaseline:"alphabetic",rotateWithView:"boolean"==typeof e.rotateWithView&&e.rotateWithView,fill:this._getFill(e.textFill),stroke:this._getStroke(e.textStroke)})}catch(e){console.log(e)}}},{key:"_getImage",value:function(e){try{return"icon"===(e=e||{}).type?this._getIcon(e.image):this._getRegularShape(e.image)}catch(e){console.log(e)}}},{key:"_getIcon",value:function(e){try{return e=e||{},new ol.style.Icon({anchor:e.imageAnchor?e.imageAnchor:[.5,.5],anchorXUnits:e.imageAnchorXUnits?e.imageAnchorXUnits:"fraction",anchorYUnits:e.imageAnchorYUnits?e.imageAnchorYUnits:"fraction",anchorOrigin:e.imageAnchorOrigin?e.imageAnchorYUnits:"top-left",color:e.imageColor?e.imageColor:void 0,crossOrigin:e.crossOrigin?e.crossOrigin:void 0,img:e.img?e.img:void 0,offset:e.offset&&Array.isArray(e.offset)&&2===e.offset.length?e.offset:[0,0],offsetOrigin:e.offsetOrigin?e.offsetOrigin:"top-left",scale:"number"==typeof e.scale?e.scale:1,snapToPixel:"boolean"!=typeof e.snapToPixel||e.snapToPixel,rotateWithView:"boolean"==typeof e.rotateWithView&&e.rotateWithView,opacity:"number"==typeof e.imageOpacity?e.imageOpacity:1,rotation:"number"==typeof e.imageRotation?e.imageRotation:0,size:e.size&&Array.isArray(e.size)&&2===e.size.length?e.size:void 0,imgSize:e.imgSize&&Array.isArray(e.imgSize)&&2===e.imgSize.length?e.imgSize:void 0,src:e.imageSrc?e.imageSrc:void 0})}catch(e){console.log(e)}}},{key:"_getRegularShape",value:function(e){try{return new ol.style.RegularShape({fill:this._getFill(e.fill)||void 0,points:"number"==typeof e.points?e.points:1,radius:"number"==typeof e.radius?e.radius:void 0,radius1:"number"==typeof e.radius1?e.radius1:void 0,radius2:"number"==typeof e.radius2?e.radius2:void 0,angle:"number"==typeof e.angle?e.angle:0,snapToPixel:"boolean"!=typeof e.snapToPixel||e.snapToPixel,stroke:this._getStroke(e.stroke)||void 0,rotation:"number"==typeof e.rotation?e.rotation:0,rotateWithView:"boolean"==typeof e.rotateWithView&&e.rotateWithView,atlasManager:e.atlasManager?e.atlasManager:void 0})}catch(e){console.log(e)}}}]),e}();e.exports=r}])});
//# sourceMappingURL=AnimatorFactory.js.map